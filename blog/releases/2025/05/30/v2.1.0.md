---
title: V2.1.0
description: 更新
# slug: welcome-docusaurus-v2
authors: ningmengchongshui
tags: [更新]
image: https://i.imgur.com/mErPwqL.png
hide_table_of_contents: false
---

# 更新记录

- 优化 useSubscribe

!!! useSubscribe 和 2.0 不兼容

```ts
import { Text, useMessage } from 'alemonjs'
const selects = onSelects(['message.create'])
export default onResponse(selects, event => {
  const [subscribe] = useSubscribe(event, selects)
  subscribe.monut(Res.current, ['UserId']) // res 响应之前

  // more ...
  subscribe.create(Res.current, []) // res 创建之后
  subscribe.unmonut(Res.current, []) // res 响应之后
})
```

- 新增 useMessage

```ts
import { Text, useMessage } from 'alemonjs'
const selects = onSelects(['message.create'])
export default onResponse(selects, event => {
  const [message] = useMessage(event)
  message.send(format(Text('Hello Word!')))
})
```

- 新增 useClient

```ts
import {
  platform as qqbot,
  useClient
} from '@alemonjs/qq-bot'
const selects = onSelects(['message.create'])
export default onResponse(selects, event => {
  if (event.platform === qqbot) {
    const [client, value] = useClient(event)
    // 使用原生api和数据
  }
})
```

- 新增 defineResponse

支持定义路由规则来更细致化的控制和管理响应。有效提高匹配效率。

```ts title="src/router.ts"
import { lazy } from 'alemonjs'
export default defineResponse([
  {
    // 用户验证中间件。这是局部的，仅对 children 下的响应规则生效
    handler: lazy(() => import('@src/response/mw')),
    children: [
      {
        // 匹配正则
        regular: /^(!|！|\/|#|＃)?我的信息/,
        handler: lazy(
          () =>
            import('@src/response/user-message/base/res')
        )
      }
    ]
  }
])
```

- defineMiddleware

支持定义中间件路由规则来更细致化的控制和管理响应。有效提高匹配效率。

```ts title="src/router-mw.ts"
import { lazy } from 'alemonjs'
export default defineMiddleware([
  {
    handler: lazy(() => import('./middleware/mw'))
  }
])
```
