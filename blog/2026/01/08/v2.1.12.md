---
title: V2.1.12
description: 更新
# slug: welcome-docusaurus-v2
authors: ningmengchongshui
tags: [更新]
image: https://i.imgur.com/mErPwqL.png
hide_table_of_contents: false
---

# 更新记录

:::warning

主要是一些比较重要的修复和优化

:::

- utils

修复 Regular 处理带Flags的正则时,出现代码崩溃

```ts
import { Regular } from 'alemonjs/utils'
```

- useMe

```ts
import { useMe } from 'alemonjs'
const selects = onSelects(['message.create'])
export default onResponse(selects, event => {
  const [me] = useMe()

  // 机器人个人信息
  const info = await me.info()
})
```

- getMessageIntent

> 试验中

```ts
import { useMessage, getMessageIntent, ResultCode, MD } from 'alemonjs'

const selects = onSelects(['message.create'])

export default onResponse(selects, async event => {
  const [message] = useMessage(event)

  // 获取消息意图
  const intentRes = await getMessageIntent()
  const intent = intentRes.data

  if (intentRes.code !== ResultCode.Ok || !intent) {
    return
  }
  // 根据意图，进行消息处理
  // 比如我现在打算发送图文。就必须要判断是否支持图片，不支持的情况下要进行降级消费
  if (intent.allowMixImageText) {
    message.addText('这是图文混合消息')
    message.addImage(new Buffer(''))
    // 发送
    message.send()
  } else {
    // 单独发送文字和图片
    const text = '这是仅文字消息，图片无法发送，因为平台不支持图文混合发送'
    message.addText(text)
    message.send()
    // 清理消息内容，准备发送图片
    message.clear()
    message.addImage(new Buffer(''))
    message.send()
  }

  // 长度为0表示禁止发送md
  if (!intent.maxMarkdownLength) {
    //
  } else {
    message.addMarkdown(MD.text('这是 Markdown 消息')).send()
  }
})
```
